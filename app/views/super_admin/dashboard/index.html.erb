<div class="py-5">
  <div class="container">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
      <div>
        <h1 class="mb-1"><i class="fas fa-crown me-2 text-warning"></i>Super Admin Panel</h1>
        <p class="text-muted mb-0">Manage every admin and user account from here.</p>
      </div>
      <%= link_to "Back to Dashboard", admin_dashboard_path, class: "btn btn-outline-secondary" %>
    </div>

    <div class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <p class="text-muted text-uppercase fw-semibold small mb-1">Total Users</p>
            <h3 class="fw-bold"><%= User.count %></h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <p class="text-muted text-uppercase fw-semibold small mb-1">Admins</p>
            <h3 class="fw-bold text-primary"><%= @admins.count %></h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <p class="text-muted text-uppercase fw-semibold small mb-1">Customers</p>
            <h3 class="fw-bold text-success"><%= @customers.count %></h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <p class="text-muted text-uppercase fw-semibold small mb-1">Active Orders</p>
            <h3 class="fw-bold text-info"><%= Order.where.not(status: 'delivered').count %></h3>
          </div>
        </div>
      </div>
    </div>

    <div class="card mb-5">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0"><i class="fas fa-user-shield me-2 text-primary"></i>Create Admin Account</h4>
          <span class="text-muted small">CNIC limit: up to 5 admin-managed accounts per CNIC</span>
        </div>

        <% if @new_admin.errors.any? %>
          <div class="alert alert-danger">
            <strong class="d-block mb-2">Please fix the highlighted issues:</strong>
            <ul class="mb-0">
              <% @new_admin.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <%= form_with model: @new_admin, url: create_admin_super_admin_users_path, local: true do |f| %>
          <div class="row g-3">
            <div class="col-md-4">
              <%= f.label :first_name, class: "form-label fw-semibold" %>
              <%= f.text_field :first_name, class: "form-control", required: true %>
            </div>
            <div class="col-md-4">
              <%= f.label :last_name, class: "form-label fw-semibold" %>
              <%= f.text_field :last_name, class: "form-control", required: true %>
            </div>
            <div class="col-md-4">
              <%= f.label :email, class: "form-label fw-semibold" %>
              <%= f.email_field :email, class: "form-control", required: true %>
            </div>
            <div class="col-md-4">
              <%= f.label :phone, class: "form-label fw-semibold" %>
              <%= f.telephone_field :phone, class: "form-control", placeholder: "+923001234567", required: true %>
            </div>
            <div class="col-md-4">
              <%= f.label :cnic, class: "form-label fw-semibold" %>
              <%= f.text_field :cnic, class: "form-control", maxlength: 13, minlength: 13, placeholder: "13-digit CNIC", required: true %>
            </div>
            <div class="col-md-4">
              <%= f.label :password, class: "form-label fw-semibold" %>
              <%= f.password_field :password, class: "form-control", minlength: Devise.password_length.min, required: true %>
            </div>
            <div class="col-md-4">
              <%= f.label :password_confirmation, class: "form-label fw-semibold" %>
              <%= f.password_field :password_confirmation, class: "form-control", required: true %>
            </div>
          </div>
          <div class="d-grid d-md-flex justify-content-md-end mt-4">
            <%= f.submit "Create Admin", class: "btn btn-primary px-4" %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-user-tie me-2 text-primary"></i>Admins</h5>
          </div>
          <div class="card-body">
            <% if @admins.any? %>
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>CNIC</th>
                      <th>Points</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @admins.each do |admin| %>
                      <tr>
                        <td>
                          <strong><%= admin.full_name %></strong>
                          <% if admin.super_admin? %>
                            <br><span class="badge bg-warning text-dark">Super Admin</span>
                          <% end %>
                        </td>
                        <td><%= admin.email %></td>
                        <td><%= admin.cnic.presence || tag.span("N/A", class: "text-muted") %></td>
                        <td><span class="badge bg-success"><%= admin.points %></span></td>
                        <td>
                          <% unless admin.super_admin? %>
                            <%= button_to "Demote to User",
                                          demote_to_user_super_admin_user_path(admin),
                                          method: :patch,
                                          class: "btn btn-sm btn-outline-danger",
                                          data: { turbo_confirm: "Demote #{admin.full_name} to customer?" } %>
                          <% else %>
                            <span class="text-muted small">Cannot demote</span>
                          <% end %>
                        </td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            <% else %>
              <p class="text-muted">No admin accounts found.</p>
            <% end %>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-users me-2 text-secondary"></i>Customers</h5>
          </div>
          <div class="card-body">
            <% if @customers.any? %>
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>CNIC</th>
                      <th>Points</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @customers.each do |customer| %>
                      <tr>
                        <td><strong><%= customer.full_name %></strong></td>
                        <td><%= customer.email %></td>
                        <td><%= customer.cnic.presence || tag.span("N/A", class: "text-muted") %></td>
                        <td><span class="badge bg-success"><%= customer.points %></span></td>
                        <td>
                          <%= button_to "Promote to Admin",
                                        promote_to_admin_super_admin_user_path(customer),
                                        method: :patch,
                                        class: "btn btn-sm btn-outline-primary",
                                        data: { turbo_confirm: "Promote #{customer.full_name} to admin?" } %>
                        </td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            <% else %>
              <p class="text-muted">No customer accounts available.</p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

